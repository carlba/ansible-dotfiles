---
# https://github.com/cdown/ansible-aur


- name: make sure cron is working
  package:
    name: cronie
    state: present

- name: check if pip is installed
  shell: which pip
  register: is_pip_installed
  changed_when: false

- name: install pip
  shell: curl https://bootstrap.pypa.io/get-pip.py | python
  when: is_pip_installed.rc != 0

- name: "make sure usb drives mounts automatically"
  become: true
  package:
    name: udiskie
    state: present

- block:
  - name: set dpi to 98
    blockinfile:
      marker: "# {mark} ANSIBLE MANAGED BLOCK (set dpi to 98)"
      dest: "{{ ansible_env.HOME }}/.Xresources"
      block: "Xft.dpi:98"

  - name: set dpi to 98 (permanently)
    blockinfile:
      marker: "# {mark} ANSIBLE MANAGED BLOCK (set dpi to 98)"
      dest: "{{ ansible_env.HOME }}/.xprofile"
      block: "xrandr --dpi 98"

  - name: check dpi
    shell: xdpyinfo | grep dots | cut -d' ' -f 7
    register: dpi_command_result
    changed_when: false

  - name: set dpi variable
    set_fact:
      dpi: "{{ dpi_command_result.stdout.split('x') | first() }}"

  - name: set dpi to 98 (temporarily)
    shell: "xrandr --dpi 98"
    when: dpi != "98"